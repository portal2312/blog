<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>postgres - installation | Portal2312&#39;s blog</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="postgres - installation" />
<meta name="author" content="mkkim" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Installation" />
<meta property="og:description" content="Installation" />
<link rel="canonical" href="/blog/docs/develop/A-M/database/Postgres/postgres%20-%20installation.html" />
<meta property="og:url" content="/blog/docs/develop/A-M/database/Postgres/postgres%20-%20installation.html" />
<meta property="og:site_name" content="Portal2312&#39;s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-12-02T16:38:51+09:00" />
<script type="application/ld+json">
{"description":"Installation","headline":"postgres - installation","dateModified":"2019-12-02T16:38:51+09:00","datePublished":"2019-12-02T16:38:51+09:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/blog/docs/develop/A-M/database/Postgres/postgres%20-%20installation.html"},"url":"/blog/docs/develop/A-M/database/Postgres/postgres%20-%20installation.html","author":{"@type":"Person","name":"mkkim"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href='/blog/assets/main.css'><link type="application/atom+xml" rel="alternate" href="/blog/feed.xml" title="Portal2312's blog" /><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-113063601-1', 'auto');
  ga('send', 'pageview');
}
</script>
  
<script src='/blog/dist/js/common.bundle.js'></script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/blog/">Portal2312&#39;s blog</a>
    <nav class="site-nav">
    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
    <label for="nav-trigger">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
        </svg>
      </span>
    </label>

    <div class="trigger"><a class="page-link" href="/blog/about.html">
            About
          </a><a class="page-link" href="/blog/posts.html">
            Posts
          </a><a class="page-link" href="/blog/history.html">
            History
          </a><a class="page-link" href="/blog/docs/index.html">
            Docs
          </a></div>
  </nav>
  </div>
  <div class="scroll-indicator-container">
  <div class="scroll-indicator-bar" id="scrollIndicatorBar"></div>
</div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h1>postgres - installation</h1>

  <div>
    <h2>Table of contents</h2>
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#installation">Installation</a>
<ul>
<li class="toc-entry toc-h3"><a href="#for-windows">for Windows</a></li>
<li class="toc-entry toc-h3"><a href="#for-linux">For Linux</a>
<ul>
<li class="toc-entry toc-h4"><a href="#package-manager">package manager</a></li>
<li class="toc-entry toc-h4"><a href="#yum-repository-yum">Yum Repository (yum 저장소 설치)</a></li>
<li class="toc-entry toc-h4"><a href="#direct-rpm-download">Direct RPM download</a></li>
<li class="toc-entry toc-h4"><a href="#compile-repository">Compile 설치 (Repository를 권장함)</a></li>
<li class="toc-entry toc-h4"><a href="#post-installation-setup-compile">Post-Installation Setup (compile 설치후 설정, 추후 업데이트 예정)</a></li>
<li class="toc-entry toc-h4"><a href="#systemctl-restart-yum">systemctl 설정 및 restart (yum 설치 후 설정)</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#for-archlinux-manjaro">For ArchLinux (manjaro)</a></li>
<li class="toc-entry toc-h3"><a href="#ubuntu">Ubuntu</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#references">References</a></li>
</ul><h2 id="installation">
<a class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<h3 id="for-windows">
<a class="anchor" href="#for-windows" aria-hidden="true"><span class="octicon octicon-link"></span></a>for Windows</h3>

<ul>
<li><p>공식 홈페이지에서 Windows installers 내려받아 설치.</p></li>
<li><p>설치는 기본적으로 어렵지 않아 생략.</p></li>
<li><p>환경변수설정
```
시스템 &gt; 고급 시스템 설정 &gt; 환경 변수 &gt; 시스템 변수 &gt; "Path" 편집 &gt;
C:\Program Files\PostgreSQL\9.5\bin;기존path &gt; 저장 &gt;</p></li>
</ul>

<p>cmd 창 새로 띄우기
  ```</p>

<ul>
<li>작성중</li>
</ul>

<hr>

<h3 id="for-linux">
<a class="anchor" href="#for-linux" aria-hidden="true"><span class="octicon octicon-link"></span></a>For Linux</h3>

<h4 id="package-manager">
<a class="anchor" href="#package-manager" aria-hidden="true"><span class="octicon octicon-link"></span></a>package manager</h4>

<p>package list:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">postgresql postgresql-server postgresql-contrib
</code></pre></div>
<p>package manager: <code>pacman -S</code>, <code>apt-get install</code>, <code>yum install</code></p>

<p>example:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get <span class="nb">install </span>postgresql postgresql-server postgresql-contrib
</code></pre></div>
<hr>

<h4 id="yum-repository-yum">
<a class="anchor" href="#yum-repository-yum" aria-hidden="true"><span class="octicon octicon-link"></span></a>Yum Repository (yum 저장소 설치)</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="c"># http://yum.postgresql.org/version-name/ 들어가서 조회하면 신규 저장소를 찾을 수 있음</span>
  <span class="nv">$ </span>yum <span class="nb">install </span>http://yum.postgresql.org/9.5/redhat/rhel-7-x86_64/pgdg-redhat95-9.5-2.noarch.rpm

  <span class="c"># 저장소를 추가했기 때문에 많은 목록이 추가되었을 수 있음.</span>
  <span class="nv">$ </span>yum search postgres

  <span class="c"># postgresqlxx-contrib: postgres의 제공된 소스 및 바이너리 배포</span>
  <span class="c"># postgresqlxx-server: 실제 운영하는 postgres</span>
  <span class="c"># postgresqlxx-devel: postgres의 개발 header 와 library</span>
  <span class="nv">$ </span>yum <span class="nb">install </span>postgresqlxx-server postgresqlxx-contrib postgresqlxx-devel
</code></pre></div>
<hr>

<h4 id="direct-rpm-download">
<a class="anchor" href="#direct-rpm-download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Direct RPM download</h4>

<p><a href="http://yum.postgresql.org/rpmchart.php">http://yum.postgresql.org/rpmchart.php</a></p>

<hr>

<h4 id="compile-repository">
<a class="anchor" href="#compile-repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compile 설치 (Repository를 권장함)</h4>

<p><a href="https://www.postgresql.org/docs/9.6/static/installation.html">https://www.postgresql.org/docs/9.6/static/installation.html</a></p>

<ol>
<li>File downloads</li>
</ol>

<p>Downloads &gt; Linux &gt; Other &gt; Build from source &gt; file browser.</p>

<p><a href="https://www.postgresql.org/ftp/source/">https://www.postgresql.org/ftp/source/</a></p>

<ol>
<li>Configuration</li>
</ol>

<p><a href="https://www.postgresql.org/docs/9.6/static/install-procedure.html">https://www.postgresql.org/docs/9.6/static/install-procedure.html</a></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>su -
  <span class="c"># root</span>

  <span class="nv">$ </span>./configure <span class="se">\</span>
   <span class="nt">--prefix</span><span class="o">=</span>/usr/local <span class="se">\</span>
   <span class="nt">--mandir</span><span class="o">=</span>/usr/local/share/man <span class="se">\</span>
   <span class="nt">--datadir</span><span class="o">=</span>/usr/local/share/postgresql <span class="se">\</span>
   <span class="nt">--sysconfdir</span><span class="o">=</span>/usr/local/etc <span class="se">\</span>
   <span class="nt">--with-gssapi</span> <span class="se">\</span>
   <span class="nt">--with-libxml</span> <span class="se">\</span>
   <span class="nt">--with-openssl</span> <span class="se">\</span>
   <span class="nt">--with-perl</span> <span class="se">\</span>
   <span class="nt">--with-tcl</span> <span class="se">\</span>
   <span class="nt">--with-pam</span> <span class="se">\</span>
   <span class="nt">--with-system-tzdata</span><span class="o">=</span>/usr/share/zoneinfo <span class="se">\</span>
   <span class="nt">--with-uuid</span><span class="o">=</span>e2fs <span class="se">\</span>
   <span class="nt">--enable-nls</span> <span class="se">\</span>
   <span class="nt">--enable-thread-safety</span>

  <span class="nv">$ </span>make
  <span class="nv">$ </span>make <span class="nb">install</span>

  <span class="nv">$ </span>ldconfig
</code></pre></div>
<ol>
<li>postgres 계정 생성</li>
</ol>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>userdel <span class="nt">-r</span> postgres
  <span class="nv">$ </span>useradd <span class="nt">-s</span> <span class="nt">-m</span> <span class="s1">'/bin/bash'</span> postgres
  <span class="nv">$ </span>passwd postgres
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>su postgres
  <span class="nv">$ </span>initdb <span class="nt">--locale</span><span class="o">=</span>ko_KR.UTF-8 <span class="nt">-D</span> data
  <span class="nv">$ </span>createdb <span class="nt">--locale</span><span class="o">=</span>ko_KR.UTF-8 &lt;dababase-name&gt;
</code></pre></div>
<ul>
<li>
<p>backupDB:</p>
<div class="highlight"><pre><code class="language-" data-lang="">$ /usr/local/bin/pg_upgrade -d /var/lib/postgres/data9.5  -D   /var/lib/postgres/data -b /usr/local/bin -B /usr/local/bin
</code></pre></div>
</li>
</ul>

<ol>
<li>systemctl 등록</li>
</ol>

<p><strong>잘 안되서 확인 중</strong>
  ```bash
  # /lib/systems/system/postgresql.service</p>
<div class="highlight"><pre><code class="language-" data-lang="">
  ```bash
  $ systemctl unmask postgresql
  $ systemctl start postgresql
  $ systemctl enable postgresql
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>su - postgres
  <span class="nv">$ </span>/usr/local/bin/pg_ctl <span class="nt">-s</span> <span class="nt">-D</span> <span class="k">${</span><span class="nv">PGROOT</span><span class="k">}</span>/data start <span class="nt">-w</span> <span class="nt">-t</span> 120
  <span class="nv">$ </span>/usr/localq/bin/pg_ctl <span class="nt">-s</span> <span class="nt">-D</span> <span class="k">${</span><span class="nv">PGROOT</span><span class="k">}</span>/data reload
  <span class="nv">$ </span>/usr/local/bin/pg_ctl <span class="nt">-s</span> <span class="nt">-D</span> <span class="k">${</span><span class="nv">PGROOT</span><span class="k">}</span>/data stop <span class="nt">-m</span> fast
</code></pre></div>
<ol>
<li>Installation Procedure</li>
</ol>

<ul>
<li><a href="(https://www.postgresql.org/docs/current/static/installation.html)">installation</a></li>
</ul>

<h4 id="post-installation-setup-compile">
<a class="anchor" href="#post-installation-setup-compile" aria-hidden="true"><span class="octicon octicon-link"></span></a>Post-Installation Setup (compile 설치후 설정, 추후 업데이트 예정)</h4>

<ul>
<li>Shared Libraries</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"/usr/local/pgsql/lib"</span>
</code></pre></div>
<ul>
<li>Environment Variables
<code>bash
# /etc/profile - All users
# ~/.bash_profile - users
export PATH="/usr/local/pgsql/bin:$PATH"
</code>
</li>
</ul>

<h4 id="systemctl-restart-yum">
<a class="anchor" href="#systemctl-restart-yum" aria-hidden="true"><span class="octicon octicon-link"></span></a>systemctl 설정 및 restart (yum 설치 후 설정)</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>su -
<span class="nv">$ </span>systemctl start postgres.service

<span class="c"># XXX: error</span>
<span class="c"># ● postgresql-9.5.service - PostgreSQL 9.5 database server</span>
<span class="c">#    Loaded: loaded (/usr/lib/systemd/system/postgresql-9.5.service; enabled; vendor preset: disabled)</span>
<span class="c">#    Active: failed (Result: exit-code) since 목 2017-02-16 17:43:59 KST; 15min ago</span>

<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: Starting PostgreSQL 9.5 database server...</span>
<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: postgresql-9.5.service: control process exited, code=exited status=1</span>
<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: Failed to start PostgreSQL 9.5 database server.</span>
<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: Unit postgresql-9.5.service entered failed state.</span>
<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: postgresql-9.5.service failed.</span>


<span class="c"># XXX: 더 자세한 로그를 확인</span>
<span class="c">#      PGDATA 경로가 설정과 안맞다라고 나옴</span>
<span class="nv">$ </span>systemctl status postgres.service

<span class="c"># ● postgresql-9.5.service - PostgreSQL 9.5 database server</span>
<span class="c">#    Loaded: loaded (/usr/lib/systemd/system/postgresql-9.5.service; enabled; vendor preset: disabled)</span>
<span class="c">#    Active: failed (Result: exit-code) since 목 2017-02-16 17:59:27 KST; 2min 1s ago</span>
<span class="c">#   Process: 75601 ExecStartPre=/usr/pgsql-9.5/bin/postgresql95-check-db-dir ${PGDATA} (code=exited, status=1/FAILURE)  # XXX: PGDATA 경로가 설정과 안맞다라고 나옴</span>

<span class="c">#  2월 16 17:59:26 localhost.localdomain systemd[1]: Starting PostgreSQL 9.5 database server...</span>
<span class="c">#  2월 16 17:59:27 localhost.localdomain systemd[1]: postgresql-9.5.service: control process exited, code=exited status=1</span>
<span class="c">#  2월 16 17:59:27 localhost.localdomain systemd[1]: Failed to start PostgreSQL 9.5 database server.</span>
<span class="c">#  2월 16 17:59:27 localhost.localdomain systemd[1]: Unit postgresql-9.5.service entered failed state.</span>
<span class="c">#  2월 16 17:59:27 localhost.localdomain systemd[1]: postgresql-9.5.service failed.</span>


<span class="nv">$ </span>vi /usr/lib/systemd/system/postgresql-9.5.service

... <span class="o">(</span>생략<span class="o">)</span>

<span class="c"># XXX: 이전 경로</span>
<span class="c">#      설치시 default Data 경로를 나타냄</span>
<span class="c"># Environment=PGDATA=/var/lib/pgsql/9.5/data/</span>

<span class="c"># XXX: 수정함, 원하는 경로</span>
<span class="nv">Environment</span><span class="o">=</span><span class="nv">PGDATA</span><span class="o">=</span>/usr/pgsql-9.5/data/


... <span class="o">(</span>생략<span class="o">)</span>

:wq  <span class="c"># XXX: 저장후 닫기</span>


<span class="nv">$ </span>systemctl daemon-reload  <span class="c"># XXX: systemctl daemon 문서 수정시 reload 해야 적용됨</span>
<span class="nv">$ </span>systemctl start postgres.service

<span class="c"># XXX: error - 이미 동작하고 있다 나옴</span>
<span class="c">#      설치하면서 tutorial 에 postgres 로 동작해서 발생된 문제</span>
<span class="c"># ● postgresql-9.5.service - PostgreSQL 9.5 database</span>
<span class="c">#    Loaded: loaded (/usr/lib/systemd/system/postgresql-9.5.service; enabled; vendor preset: disabled)</span>
<span class="c">#    Active: failed (Result: exit-code) since 목 2017-02-16 18:05:31 KST; 10s ago</span>
<span class="c">#   Process: 77953 ExecStart=/usr/pgsql-9.5/bin/pg_ctl start -D ${PGDATA} -s -w -t 300 (code=exited, status=1/FAILURE)</span>
<span class="c">#   Process: 77947 ExecStartPre=/usr/pgsql-9.5/bin/postgresql95-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS)</span>

<span class="c">#  2월 16 18:05:30 localhost.localdomain systemd[1]: Starting PostgreSQL 9.5 database server...</span>
<span class="c">#  2월 16 18:05:30 localhost.localdomain pg_ctl[77953]: pg_ctl: 다른 서버가 가동 중인 것 같음; 어째든 서버 가동을 시도함</span>
<span class="c">#  2월 16 18:05:30 localhost.localdomain pg_ctl[77953]: &lt; 2017-02-16 18:05:30.499 KST &gt;FATAL:  lock file "postmaster.pid" already exists</span>
<span class="c">#  2월 16 18:05:30 localhost.localdomain pg_ctl[77953]: &lt; 2017-02-16 18:05:30.499 KST &gt;HINT:  Is another postmaster (PID 72833) running in data directory "/usr/pgsql-9.5/data"?</span>
<span class="c">#  2월 16 18:05:31 localhost.localdomain pg_ctl[77953]: pg_ctl: 서버를 시작 할 수 없음</span>
<span class="c">#  2월 16 18:05:31 localhost.localdomain pg_ctl[77953]: 로그 출력을 살펴보십시오.</span>
<span class="c">#  2월 16 18:05:31 localhost.localdomain systemd[1]: postgresql-9.5.service: control process exited, code=exited status=1</span>
<span class="c">#  2월 16 18:05:31 localhost.localdomain systemd[1]: Failed to start PostgreSQL 9.5 database server.</span>

<span class="nv">$ </span>su - postgres
<span class="nv">$ </span>/usr/pgsql-9.5/bin/pg_ctl <span class="nt">-D</span> /usr/pgsql-9.5/data <span class="nt">-l</span> ./logfile stop
<span class="c"># XXX: postgres 로 동작한 daemon 중지</span>

<span class="nv">$ </span>su -
<span class="nv">$ </span>systemctl restart postgres.service
<span class="c"># XXX: 잘 돌면 깔끔하게 아무 메시지도 없음</span>

<span class="nv">$ </span>su - postgres
<span class="nv">$ </span>psql &lt;db-name&gt;  <span class="c"># XXX: 접속</span>
</code></pre></div>
<hr>

<h3 id="for-archlinux-manjaro">
<a class="anchor" href="#for-archlinux-manjaro" aria-hidden="true"><span class="octicon octicon-link"></span></a>For ArchLinux (manjaro)</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>su -
<span class="nv">$ </span>pacman <span class="nt">-Ss</span> postgres
<span class="nv">$ </span>pacman <span class="nt">-S</span> postgres
<span class="nv">$ </span>shutdown <span class="nt">-r</span> now  <span class="c"># XXX: postgres-bug로 서버 재시작 해야되는 경우도 있음</span>

<span class="nv">$ </span>su - postgres

<span class="c"># root &gt; postgres</span>
<span class="nv">$ </span><span class="nb">pwd</span>
<span class="c"># /var/lib/postgres</span>
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># postgres &gt; root</span>
<span class="nv">$ </span>userdel <span class="nt">-r</span> postgres
<span class="nv">$ </span>useradd <span class="nt">-m</span> postgres  <span class="c"># /home/postgres 안생길 경우 아래 참조</span>
<span class="nv">$ </span>passwd postgres
<span class="c"># New password:</span>
<span class="nv">$ </span>su - postgres

<span class="c"># root &gt; postgres</span>
<span class="nv">$ </span><span class="nb">mkdir </span>data
<span class="nv">$ </span>initdb <span class="nt">-D</span> /home/postgres/data
</code></pre></div>
<p>useradd 후 /home/postgres 안생길 경우 아래 참조</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>su -
<span class="nv">$ </span>useradd <span class="nt">-m</span> <span class="nt">-G</span> <span class="nb">users</span> <span class="nt">-s</span> /bin/bash postgres
<span class="c"># useradd -m -G &lt;group-name&gt; -s &lt;shell-path&gt; &lt;userid&gt;</span>

<span class="c"># options</span>
<span class="c"># -m --create-home</span>
</code></pre></div>
<p>그룹 확인하기</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat</span> /etc/group

<span class="c"># ...</span>
<span class="c"># users:x:100</span>
<span class="c"># ...</span>
</code></pre></div>
<hr>

<h3 id="ubuntu">
<a class="anchor" href="#ubuntu" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ubuntu</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>apt-get <span class="nb">install </span>postgresql-10
</code></pre></div>
<p>설치된 postgresql-10 의 기본 경로: <code>/usr/lib/postgresql/10</code></p>

<p>postgres 계정의 기본 경로: <code>/var/lib/postgresql</code></p>

<p>Short Version 경로와 install 된 경로와 맞추기:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">ln</span> <span class="nt">-s</span> /usr/lib/postgresql /usr/local/pgsql
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>su - postgres
<span class="nv">$ </span>/usr/lib/postgresql/10/bin/initdb <span class="nt">-D</span> /var/lib/postgresql/10/data
<span class="nv">$ </span>/usr/local/pgsql/10/bin/postgres <span class="nt">-D</span> /var/lib/postgresql/10/data/ <span class="o">&gt;</span>logfile 2&gt;&amp;1 &amp;
</code></pre></div>
<h2 id="references">
<a class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h2>

<ul>
<li><p><a href="https://www.postgresql.org/docs/current/static/installation.html">https://www.postgresql.org/docs/current/static/installation.html</a></p></li>
<li><p><a href="https://yum.postgresql.org/repopackages.php">https://yum.postgresql.org/repopackages.php</a></p></li>
<li><p><a href="https://www.postgresql.org/ftp/source/">https://www.postgresql.org/ftp/source/</a></p></li>
</ul>

  </div>

<div>
  <h2 id="installation">Installation</h2>

<h3 id="for-windows">for Windows</h3>

<ul>
<li><p>공식 홈페이지에서 Windows installers 내려받아 설치.</p></li>
<li><p>설치는 기본적으로 어렵지 않아 생략.</p></li>
<li><p>환경변수설정
```
시스템 &gt; 고급 시스템 설정 &gt; 환경 변수 &gt; 시스템 변수 &gt; "Path" 편집 &gt;
C:\Program Files\PostgreSQL\9.5\bin;기존path &gt; 저장 &gt;</p></li>
</ul>

<p>cmd 창 새로 띄우기
  ```</p>

<ul>
<li>작성중</li>
</ul>

<hr>

<h3 id="for-linux">For Linux</h3>

<h4 id="package-manager">package manager</h4>

<p>package list:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">postgresql postgresql-server postgresql-contrib
</code></pre></div>
<p>package manager: <code>pacman -S</code>, <code>apt-get install</code>, <code>yum install</code></p>

<p>example:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get <span class="nb">install </span>postgresql postgresql-server postgresql-contrib
</code></pre></div>
<hr>

<h4 id="yum-repository-yum">Yum Repository (yum 저장소 설치)</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="c"># http://yum.postgresql.org/version-name/ 들어가서 조회하면 신규 저장소를 찾을 수 있음</span>
  <span class="nv">$ </span>yum <span class="nb">install </span>http://yum.postgresql.org/9.5/redhat/rhel-7-x86_64/pgdg-redhat95-9.5-2.noarch.rpm

  <span class="c"># 저장소를 추가했기 때문에 많은 목록이 추가되었을 수 있음.</span>
  <span class="nv">$ </span>yum search postgres

  <span class="c"># postgresqlxx-contrib: postgres의 제공된 소스 및 바이너리 배포</span>
  <span class="c"># postgresqlxx-server: 실제 운영하는 postgres</span>
  <span class="c"># postgresqlxx-devel: postgres의 개발 header 와 library</span>
  <span class="nv">$ </span>yum <span class="nb">install </span>postgresqlxx-server postgresqlxx-contrib postgresqlxx-devel
</code></pre></div>
<hr>

<h4 id="direct-rpm-download">Direct RPM download</h4>

<p><a href="http://yum.postgresql.org/rpmchart.php" rel="nofollow" target="_blank">http://yum.postgresql.org/rpmchart.php</a></p>

<hr>

<h4 id="compile-repository">Compile 설치 (Repository를 권장함)</h4>

<p><a href="https://www.postgresql.org/docs/9.6/static/installation.html" rel="nofollow" target="_blank">https://www.postgresql.org/docs/9.6/static/installation.html</a></p>

<ol>
<li>File downloads</li>
</ol>

<p>Downloads &gt; Linux &gt; Other &gt; Build from source &gt; file browser.</p>

<p><a href="https://www.postgresql.org/ftp/source/" rel="nofollow" target="_blank">https://www.postgresql.org/ftp/source/</a></p>

<ol>
<li>Configuration</li>
</ol>

<p><a href="https://www.postgresql.org/docs/9.6/static/install-procedure.html" rel="nofollow" target="_blank">https://www.postgresql.org/docs/9.6/static/install-procedure.html</a></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>su -
  <span class="c"># root</span>

  <span class="nv">$ </span>./configure <span class="se">\</span>
   <span class="nt">--prefix</span><span class="o">=</span>/usr/local <span class="se">\</span>
   <span class="nt">--mandir</span><span class="o">=</span>/usr/local/share/man <span class="se">\</span>
   <span class="nt">--datadir</span><span class="o">=</span>/usr/local/share/postgresql <span class="se">\</span>
   <span class="nt">--sysconfdir</span><span class="o">=</span>/usr/local/etc <span class="se">\</span>
   <span class="nt">--with-gssapi</span> <span class="se">\</span>
   <span class="nt">--with-libxml</span> <span class="se">\</span>
   <span class="nt">--with-openssl</span> <span class="se">\</span>
   <span class="nt">--with-perl</span> <span class="se">\</span>
   <span class="nt">--with-tcl</span> <span class="se">\</span>
   <span class="nt">--with-pam</span> <span class="se">\</span>
   <span class="nt">--with-system-tzdata</span><span class="o">=</span>/usr/share/zoneinfo <span class="se">\</span>
   <span class="nt">--with-uuid</span><span class="o">=</span>e2fs <span class="se">\</span>
   <span class="nt">--enable-nls</span> <span class="se">\</span>
   <span class="nt">--enable-thread-safety</span>

  <span class="nv">$ </span>make
  <span class="nv">$ </span>make <span class="nb">install</span>

  <span class="nv">$ </span>ldconfig
</code></pre></div>
<ol>
<li>postgres 계정 생성</li>
</ol>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>userdel <span class="nt">-r</span> postgres
  <span class="nv">$ </span>useradd <span class="nt">-s</span> <span class="nt">-m</span> <span class="s1">'/bin/bash'</span> postgres
  <span class="nv">$ </span>passwd postgres
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>su postgres
  <span class="nv">$ </span>initdb <span class="nt">--locale</span><span class="o">=</span>ko_KR.UTF-8 <span class="nt">-D</span> data
  <span class="nv">$ </span>createdb <span class="nt">--locale</span><span class="o">=</span>ko_KR.UTF-8 &lt;dababase-name&gt;
</code></pre></div>
<ul>
<li>
<p>backupDB:</p>
<div class="highlight"><pre><code class="language-" data-lang="">$ /usr/local/bin/pg_upgrade -d /var/lib/postgres/data9.5  -D   /var/lib/postgres/data -b /usr/local/bin -B /usr/local/bin
</code></pre></div>
</li>
</ul>

<ol>
<li>systemctl 등록</li>
</ol>

<p><strong>잘 안되서 확인 중</strong>
  ```bash
  # /lib/systems/system/postgresql.service</p>
<div class="highlight"><pre><code class="language-" data-lang="">
  ```bash
  $ systemctl unmask postgresql
  $ systemctl start postgresql
  $ systemctl enable postgresql
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nv">$ </span>su - postgres
  <span class="nv">$ </span>/usr/local/bin/pg_ctl <span class="nt">-s</span> <span class="nt">-D</span> <span class="k">${</span><span class="nv">PGROOT</span><span class="k">}</span>/data start <span class="nt">-w</span> <span class="nt">-t</span> 120
  <span class="nv">$ </span>/usr/localq/bin/pg_ctl <span class="nt">-s</span> <span class="nt">-D</span> <span class="k">${</span><span class="nv">PGROOT</span><span class="k">}</span>/data reload
  <span class="nv">$ </span>/usr/local/bin/pg_ctl <span class="nt">-s</span> <span class="nt">-D</span> <span class="k">${</span><span class="nv">PGROOT</span><span class="k">}</span>/data stop <span class="nt">-m</span> fast
</code></pre></div>
<ol>
<li>Installation Procedure</li>
</ol>

<ul>
<li><a href="(https://www.postgresql.org/docs/current/static/installation.html)">installation</a></li>
</ul>

<h4 id="post-installation-setup-compile">Post-Installation Setup (compile 설치후 설정, 추후 업데이트 예정)</h4>

<ul>
<li>Shared Libraries</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">  <span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"/usr/local/pgsql/lib"</span>
</code></pre></div>
<ul>
<li>Environment Variables
<code>bash
# /etc/profile - All users
# ~/.bash_profile - users
export PATH="/usr/local/pgsql/bin:$PATH"
</code>
</li>
</ul>

<h4 id="systemctl-restart-yum">systemctl 설정 및 restart (yum 설치 후 설정)</h4>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>su -
<span class="nv">$ </span>systemctl start postgres.service

<span class="c"># XXX: error</span>
<span class="c"># ● postgresql-9.5.service - PostgreSQL 9.5 database server</span>
<span class="c">#    Loaded: loaded (/usr/lib/systemd/system/postgresql-9.5.service; enabled; vendor preset: disabled)</span>
<span class="c">#    Active: failed (Result: exit-code) since 목 2017-02-16 17:43:59 KST; 15min ago</span>

<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: Starting PostgreSQL 9.5 database server...</span>
<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: postgresql-9.5.service: control process exited, code=exited status=1</span>
<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: Failed to start PostgreSQL 9.5 database server.</span>
<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: Unit postgresql-9.5.service entered failed state.</span>
<span class="c">#  2월 16 17:43:59 localhost.localdomain systemd[1]: postgresql-9.5.service failed.</span>


<span class="c"># XXX: 더 자세한 로그를 확인</span>
<span class="c">#      PGDATA 경로가 설정과 안맞다라고 나옴</span>
<span class="nv">$ </span>systemctl status postgres.service

<span class="c"># ● postgresql-9.5.service - PostgreSQL 9.5 database server</span>
<span class="c">#    Loaded: loaded (/usr/lib/systemd/system/postgresql-9.5.service; enabled; vendor preset: disabled)</span>
<span class="c">#    Active: failed (Result: exit-code) since 목 2017-02-16 17:59:27 KST; 2min 1s ago</span>
<span class="c">#   Process: 75601 ExecStartPre=/usr/pgsql-9.5/bin/postgresql95-check-db-dir ${PGDATA} (code=exited, status=1/FAILURE)  # XXX: PGDATA 경로가 설정과 안맞다라고 나옴</span>

<span class="c">#  2월 16 17:59:26 localhost.localdomain systemd[1]: Starting PostgreSQL 9.5 database server...</span>
<span class="c">#  2월 16 17:59:27 localhost.localdomain systemd[1]: postgresql-9.5.service: control process exited, code=exited status=1</span>
<span class="c">#  2월 16 17:59:27 localhost.localdomain systemd[1]: Failed to start PostgreSQL 9.5 database server.</span>
<span class="c">#  2월 16 17:59:27 localhost.localdomain systemd[1]: Unit postgresql-9.5.service entered failed state.</span>
<span class="c">#  2월 16 17:59:27 localhost.localdomain systemd[1]: postgresql-9.5.service failed.</span>


<span class="nv">$ </span>vi /usr/lib/systemd/system/postgresql-9.5.service

... <span class="o">(</span>생략<span class="o">)</span>

<span class="c"># XXX: 이전 경로</span>
<span class="c">#      설치시 default Data 경로를 나타냄</span>
<span class="c"># Environment=PGDATA=/var/lib/pgsql/9.5/data/</span>

<span class="c"># XXX: 수정함, 원하는 경로</span>
<span class="nv">Environment</span><span class="o">=</span><span class="nv">PGDATA</span><span class="o">=</span>/usr/pgsql-9.5/data/


... <span class="o">(</span>생략<span class="o">)</span>

:wq  <span class="c"># XXX: 저장후 닫기</span>


<span class="nv">$ </span>systemctl daemon-reload  <span class="c"># XXX: systemctl daemon 문서 수정시 reload 해야 적용됨</span>
<span class="nv">$ </span>systemctl start postgres.service

<span class="c"># XXX: error - 이미 동작하고 있다 나옴</span>
<span class="c">#      설치하면서 tutorial 에 postgres 로 동작해서 발생된 문제</span>
<span class="c"># ● postgresql-9.5.service - PostgreSQL 9.5 database</span>
<span class="c">#    Loaded: loaded (/usr/lib/systemd/system/postgresql-9.5.service; enabled; vendor preset: disabled)</span>
<span class="c">#    Active: failed (Result: exit-code) since 목 2017-02-16 18:05:31 KST; 10s ago</span>
<span class="c">#   Process: 77953 ExecStart=/usr/pgsql-9.5/bin/pg_ctl start -D ${PGDATA} -s -w -t 300 (code=exited, status=1/FAILURE)</span>
<span class="c">#   Process: 77947 ExecStartPre=/usr/pgsql-9.5/bin/postgresql95-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS)</span>

<span class="c">#  2월 16 18:05:30 localhost.localdomain systemd[1]: Starting PostgreSQL 9.5 database server...</span>
<span class="c">#  2월 16 18:05:30 localhost.localdomain pg_ctl[77953]: pg_ctl: 다른 서버가 가동 중인 것 같음; 어째든 서버 가동을 시도함</span>
<span class="c">#  2월 16 18:05:30 localhost.localdomain pg_ctl[77953]: &lt; 2017-02-16 18:05:30.499 KST &gt;FATAL:  lock file "postmaster.pid" already exists</span>
<span class="c">#  2월 16 18:05:30 localhost.localdomain pg_ctl[77953]: &lt; 2017-02-16 18:05:30.499 KST &gt;HINT:  Is another postmaster (PID 72833) running in data directory "/usr/pgsql-9.5/data"?</span>
<span class="c">#  2월 16 18:05:31 localhost.localdomain pg_ctl[77953]: pg_ctl: 서버를 시작 할 수 없음</span>
<span class="c">#  2월 16 18:05:31 localhost.localdomain pg_ctl[77953]: 로그 출력을 살펴보십시오.</span>
<span class="c">#  2월 16 18:05:31 localhost.localdomain systemd[1]: postgresql-9.5.service: control process exited, code=exited status=1</span>
<span class="c">#  2월 16 18:05:31 localhost.localdomain systemd[1]: Failed to start PostgreSQL 9.5 database server.</span>

<span class="nv">$ </span>su - postgres
<span class="nv">$ </span>/usr/pgsql-9.5/bin/pg_ctl <span class="nt">-D</span> /usr/pgsql-9.5/data <span class="nt">-l</span> ./logfile stop
<span class="c"># XXX: postgres 로 동작한 daemon 중지</span>

<span class="nv">$ </span>su -
<span class="nv">$ </span>systemctl restart postgres.service
<span class="c"># XXX: 잘 돌면 깔끔하게 아무 메시지도 없음</span>

<span class="nv">$ </span>su - postgres
<span class="nv">$ </span>psql &lt;db-name&gt;  <span class="c"># XXX: 접속</span>
</code></pre></div>
<hr>

<h3 id="for-archlinux-manjaro">For ArchLinux (manjaro)</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>su -
<span class="nv">$ </span>pacman <span class="nt">-Ss</span> postgres
<span class="nv">$ </span>pacman <span class="nt">-S</span> postgres
<span class="nv">$ </span>shutdown <span class="nt">-r</span> now  <span class="c"># XXX: postgres-bug로 서버 재시작 해야되는 경우도 있음</span>

<span class="nv">$ </span>su - postgres

<span class="c"># root &gt; postgres</span>
<span class="nv">$ </span><span class="nb">pwd</span>
<span class="c"># /var/lib/postgres</span>
<span class="nv">$ </span><span class="nb">exit</span>

<span class="c"># postgres &gt; root</span>
<span class="nv">$ </span>userdel <span class="nt">-r</span> postgres
<span class="nv">$ </span>useradd <span class="nt">-m</span> postgres  <span class="c"># /home/postgres 안생길 경우 아래 참조</span>
<span class="nv">$ </span>passwd postgres
<span class="c"># New password:</span>
<span class="nv">$ </span>su - postgres

<span class="c"># root &gt; postgres</span>
<span class="nv">$ </span><span class="nb">mkdir </span>data
<span class="nv">$ </span>initdb <span class="nt">-D</span> /home/postgres/data
</code></pre></div>
<p>useradd 후 /home/postgres 안생길 경우 아래 참조</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>su -
<span class="nv">$ </span>useradd <span class="nt">-m</span> <span class="nt">-G</span> <span class="nb">users</span> <span class="nt">-s</span> /bin/bash postgres
<span class="c"># useradd -m -G &lt;group-name&gt; -s &lt;shell-path&gt; &lt;userid&gt;</span>

<span class="c"># options</span>
<span class="c"># -m --create-home</span>
</code></pre></div>
<p>그룹 확인하기</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat</span> /etc/group

<span class="c"># ...</span>
<span class="c"># users:x:100</span>
<span class="c"># ...</span>
</code></pre></div>
<hr>

<h3 id="ubuntu">Ubuntu</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>apt-get <span class="nb">install </span>postgresql-10
</code></pre></div>
<p>설치된 postgresql-10 의 기본 경로: <code>/usr/lib/postgresql/10</code></p>

<p>postgres 계정의 기본 경로: <code>/var/lib/postgresql</code></p>

<p>Short Version 경로와 install 된 경로와 맞추기:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">ln</span> <span class="nt">-s</span> /usr/lib/postgresql /usr/local/pgsql
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>su - postgres
<span class="nv">$ </span>/usr/lib/postgresql/10/bin/initdb <span class="nt">-D</span> /var/lib/postgresql/10/data
<span class="nv">$ </span>/usr/local/pgsql/10/bin/postgres <span class="nt">-D</span> /var/lib/postgresql/10/data/ <span class="o">&gt;</span>logfile 2&gt;&amp;1 &amp;
</code></pre></div>
<h2 id="references">References</h2>

<ul>
<li><p><a href="https://www.postgresql.org/docs/current/static/installation.html" rel="nofollow" target="_blank">https://www.postgresql.org/docs/current/static/installation.html</a></p></li>
<li><p><a href="https://yum.postgresql.org/repopackages.php" rel="nofollow" target="_blank">https://yum.postgresql.org/repopackages.php</a></p></li>
<li><p><a href="https://www.postgresql.org/ftp/source/" rel="nofollow" target="_blank">https://www.postgresql.org/ftp/source/</a></p></li>
</ul>

</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Portal2312&#39;s blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Portal2312&#39;s blog</li><li><a class="u-email" href="mailto:portal2312@gmail.com">portal2312@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/portal2312"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg> <span class="username">portal2312</span></a></li><li><a href="https://www.twitter.com/portal2312"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">portal2312</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Welcome to my blog.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
